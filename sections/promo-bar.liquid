{% if section.blocks.size > 0 %}
  <div class="header__promo" data-slideshow data-autoplay="{{ section.settings.autoplay }}" data-autoplay-speed="{{ section.settings.autoplay_speed }}">
    <div class="container" style="padding:0.5rem 1.5rem;">
      {% for block in section.blocks %}
        <div data-slide data-promo-item {% if forloop.index0 > 0 %}class="hidden"{% endif %}>
          <div style="display:flex;align-items:center;justify-content:center;gap:0.75rem;background:{{ block.settings.background }};color:{{ block.settings.text_color }};padding:0.35rem 0.75rem;border-radius:999px;">
            {% if block.settings.icon_image != blank %}
              {{ block.settings.icon_image | image_url: width: 24 | image_tag: loading: 'lazy' }}
            {% elsif block.settings.icon != 'none' %}
              {% assign icon_snippet = 'icon-' | append: block.settings.icon %}
              {% render icon_snippet %}
            {% endif %}
            {% if block.settings.link != blank %}
              <a href="{{ block.settings.link }}" style="color:inherit;">{{ block.settings.text }}</a>
            {% else %}
              <span>{{ block.settings.text }}</span>
            {% endif %}
            {% if block.settings.dismissible %}
              <button class="header__icon-button" type="button" data-promo-dismiss="promo-{{ block.id }}" aria-label="Dismiss">{% render 'icon-close' %}</button>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
    {% if section.blocks.size > 1 %}
      <div class="hero__controls" aria-label="Promo bar controls">
        {% for block in section.blocks %}
          <button class="hero__dot {% if forloop.first %}is-active{% endif %}" data-slide-dot aria-label="Promo {{ forloop.index }}"></button>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endif %}

{% schema %}
{
  "name": "Promo bar",
  "settings": [
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Autoplay speed (ms)",
      "min": 3000,
      "max": 9000,
      "step": 500,
      "default": 5000
    }
  ],
  "blocks": [
    {
      "type": "promo",
      "name": "Promo",
      "settings": [
        {"type": "text", "id": "text", "label": "Text", "default": "Free shipping on orders $75+"},
        {"type": "color", "id": "background", "label": "Background", "default": "#111111"},
        {"type": "color", "id": "text_color", "label": "Text color", "default": "#ffffff"},
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "default": "none",
          "options": [
            {"value": "none", "label": "None"},
            {"value": "truck", "label": "Truck"},
            {"value": "star", "label": "Star"},
            {"value": "shield", "label": "Shield"}
          ]
        },
        {"type": "image_picker", "id": "icon_image", "label": "Custom icon"},
        {"type": "url", "id": "link", "label": "Link"},
        {"type": "checkbox", "id": "dismissible", "label": "Dismissible", "default": false}
      ]
    }
  ],
  "max_blocks": 6
}
{% endschema %}
