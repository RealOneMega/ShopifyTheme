<section class="section">
  <div class="container">
    <h1 class="heading">Your cart</h1>
    {% if cart.item_count == 0 %}
      <div class="empty-state">
        <p>Your cart is empty.</p>
        <a class="button button--primary" href="{{ routes.all_products_collection_url }}">Continue shopping</a>
      </div>
    {% else %}
      <form action="{{ routes.cart_url }}" method="post">
        <div class="cart-layout">
          <div class="stack">
            {% for item in cart.items %}
              <div class="cart-item">
                {{ item.image | image_url: width: 160 | image_tag: loading: 'lazy' }}
                <div class="cart-item__details">
                  <strong>{{ item.product.title }}</strong>
                  {% if item.options_with_values != blank %}
                    <small>
                      {% for option in item.options_with_values %}
                        {{ option.name }}: {{ option.value }}{% unless forloop.last %} / {% endunless %}
                      {% endfor %}
                    </small>
                  {% endif %}
                  <label class="visually-hidden" for="Quantity-{{ item.key }}">Quantity</label>
                  <input class="field" id="Quantity-{{ item.key }}" type="number" name="updates[]" value="{{ item.quantity }}" min="0">
                </div>
                <div class="cart-item__price">
                  <strong>{{ item.final_line_price | money }}</strong>
                  <a class="header__icon-button" href="{{ routes.cart_change_url }}?line={{ forloop.index }}&quantity=0" aria-label="Remove {{ item.product.title }}">
                    {% render 'icon-close' %}
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
          <div class="stack">
            <div class="cart-summary">
              <strong>Order summary</strong>
              <div style="display:flex;justify-content:space-between;">
                <span>Subtotal</span>
                <span>{{ cart.total_price | money }}</span>
              </div>
              <div style="display:flex;justify-content:space-between;">
                <span>Taxes</span>
                <span>{% if cart.taxes_included %}Included{% else %}Calculated at checkout{% endif %}</span>
              </div>
              <div style="display:flex;justify-content:space-between;">
                <span>Shipping</span>
                <span>Calculated at checkout</span>
              </div>
              <button class="button button--primary" type="submit" name="checkout">Checkout</button>
            </div>
            <div class="cart-summary">
              <strong>{{ section.settings.promo_heading }}</strong>
              {% assign threshold_cents = section.settings.free_shipping_threshold | times: 100 %}
              {% if threshold_cents > 0 %}
                {% assign remaining = threshold_cents | minus: cart.total_price %}
                {% if remaining > 0 %}
                  <p>Spend {{ remaining | money }} more for free shipping.</p>
                {% else %}
                  <p>You're eligible for free shipping!</p>
                {% endif %}
                {% assign progress = cart.total_price | times: 100 | divided_by: threshold_cents %}
                <div class="progress" aria-hidden="true">
                  <div class="progress__bar" style="width:{{ progress | at_most: 100 }}%;"></div>
                </div>
              {% else %}
                <p>{{ section.settings.promo_text }}</p>
              {% endif %}
            </div>
          </div>
        </div>
      </form>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Main cart",
  "settings": [
    {"type": "text", "id": "promo_heading", "label": "Promo heading", "default": "Rewards & perks"},
    {"type": "textarea", "id": "promo_text", "label": "Promo text", "default": "Points are applied at checkout once rewards are active."},
    {"type": "number", "id": "free_shipping_threshold", "label": "Free shipping threshold", "default": 0}
  ]
}
{% endschema %}
